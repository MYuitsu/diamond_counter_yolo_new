<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ph√¢n T√≠ch Kim C∆∞∆°ng</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  
</head>

<body>
  <div class="container">
    <div class="help-icon" id="helpIcon" title="L∆∞u √Ω">?</div>
    <div class="header">
      <div class="h" style="background-color: #122A05;">

      </div>
      <div class="h1">
      </div>
      <div class="h2">
        <div class="image">
          <img src="/static/imgs/diamond.gif">
        </div>
        <p>H·ªìng Ph√∫c</p>
      </div>
    </div>
    <div class="main-content">
      <div class="image-processing-container">
        <div class="upload-capture-section card">
          <h2>Nh·∫≠p H√¨nh ·∫¢nh</h2>
          <div class="tabs">
            <button class="tab-btn active" data-tab="uploadTab"
              style="background-color: #E6266F ;color: #333;font-weight: bold;font-size: 15px;border-radius: 15px;">T·∫£i
              L√™n H√¨nh ·∫¢nh</button>
            <button class="tab-btn" data-tab="captureTab"
              style="background-color:  #E6266F ;color: #333;font-weight: bold;font-size: 15px;border-radius: 15px;">Ch·ª•p
              H√¨nh ·∫¢nh</button>
          </div>
          <div id="uploadTab" class="tab-content active">
            <div class="button-group"
              style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center;">
              <label for="fileInput" class="upload-btn"
                style="border: solid 1px #E6266F; cursor: pointer; background: #44921b; color: #fff; padding: 8px 16px; display: inline-block; font-size: 14px; border-radius: 8px;">
                <input type="file" id="fileInput" accept="image/*" hidden />
                <span>Ch·ªçn T·ªáp</span>
              </label>
              <button id="enhanceBtn" class="enhance-btn" type="button"
                style="padding: 8px 16px; font-size: 14px; border-radius: 8px;">
                N√¢ng Cao Ch·∫•t L∆∞·ª£ng ·∫¢nh
              </button>
            </div>
            <div class="preview" style="position: relative; width: 320px; height: 320px; margin: 0 auto;">
              <canvas id="canvasUpload"></canvas>
              <div id="resizableBox">
                <div class="resizer top-left"></div>
                <div class="resizer top-right"></div>
                <div class="resizer bottom-left"></div>
                <div class="resizer bottom-right"></div>
              </div>
            </div>
            <div class="button-group"
              style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap; justify-content: center; align-items: center;">
              <button id="autoCutBtn" class="btn" type="button"
                style="padding: 8px 16px; font-size: 14px; border-radius: 8px;">T·ª± ƒê·ªông C·∫Øt V√† ƒê·∫øm</button>
              <div id="cutOptionsGroup" style="display:none; gap: 8px; align-items: center;">
                <label for="partSizeSelect" style="font-size: 14px;">K√≠ch th∆∞·ªõc v√πng c·∫Øt (px):</label>
                <select id="partSizeSelect" style="padding: 4px 8px; border-radius: 4px; font-size: 14px;">

                  <option value="256">256</option>
                  <option value="160" selected>160</option>
                  <option value="128">128</option>
                </select>
                <button id="confirmTrayBtn" style="padding: 8px 16px; font-size: 14px; border-radius: 8px;"
                  type="button">X√°c nh·∫≠n khay</button>
              </div>
            </div>
          </div>
          <div id="captureTab" class="tab-content">
            <p style="margin-bottom: 8px;">Ch·ª•p h√¨nh ·∫£nh c·ªßa vi√™n kim c∆∞∆°ng.</p>
            <div class="button-group"
              style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center; align-items: center;">
              <select id="cameraSelect" style="padding: 6px 12px; border-radius: 6px; font-size: 14px;">
                <option value="environment">Camera Sau</option>
                <option value="user">Camera Tr∆∞·ªõc</option>
              </select>
              <button id="openCameraBtn" class="btn" type="button"
                style="padding: 8px 16px; font-size: 14px; border-radius: 8px;">M·ªü Camera</button>
            </div>
            <div class="video-container" style="display: none; position: relative;">
              <video id="video" autoplay playsinline style="width: 100%;"></video>
              <canvas id="cameraOverlay"
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
            </div>
            <button id="takePhotoBtn" class="btn" type="button"
              style="padding: 8px 16px; font-size: 14px; border-radius: 8px; margin-top: 8px;">Ch·ª•p ·∫¢nh</button>
            <img id="capturedPhoto" style="display:none; max-width:100%; margin-top:8px;" alt="·∫¢nh ƒë√£ ch·ª•p">
            <input type="file" id="mobileCaptureInput" accept="image/*" capture="environment" style="display:none" />
          </div>
          <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" />
        </div>
        <div class="image-preview card">
          <h2>·∫¢nh K·∫øt Qu·∫£</h2>
          <div class="tabs" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 10px;">
            <button id="btnWithBox" class="tab-btn calculate-btn"
              style="background-color: #E6266F ;color: #333;font-weight: bold;font-size: 15px;border-radius: 15px;">T√≠nh
              To√°n</button>


          </div>

          <div id="totalCountDisplay" class="total-count"
            style="display: flex; justify-content: center; align-items: center;">T·ªïng s·ªë: 0üíé</div>
          <div id="annotatedCanvas"
            style="position: relative; display: flex; justify-content: center; align-items: center;">
            <div id="zoomContainer" style="overflow: hidden; cursor: grab; position: relative;">
              <canvas id="canvasAnnotated" width="320" height="320" style="display: block;"></canvas>
            </div>
            <div id="resultLoadingOverlay" style="display:none;">
              <div class="spinner"></div>
              <div class="loading-text">ƒêang x·ª≠ l√Ω, vui l√≤ng ch·ªù...</div>
            </div>
            
          </div>
          <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px;">
            <button id="saveExcelBtn" style="padding: 8px 16px; font-size: 14px; border-radius: 8px;">L∆∞u k·∫øt qu·∫£</button>
            <button id="startTrainBtn" onclick="startRetraining()" style="padding: 8px 16px; font-size: 14px; border-radius: 8px; background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; border: none; cursor: pointer; font-weight: bold;">
              üöÄ Train L·∫°i Model
            </button>
            <button id="modelInfoBtn" onclick="showModelInfo()" style="padding: 8px 16px; font-size: 14px; border-radius: 8px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; cursor: pointer; font-weight: bold;">
              ü§ñ Model Info
            </button>
          </div>
          <div id="trainStatus" style="margin-top: 8px; font-size: 12px; text-align: center; color: #666;"></div>

        </div>
      </div>
      <div class="results-container card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0;">K·∫øt Qu·∫£ ƒêo L∆∞·ªùng</h2>
          <button id="openDashboardBtn" class="dashboard-btn" type="button">üìä Th·ªëng K√™</button>
        </div>
        <table>
          <thead>
            <tr>
              <th style="padding: 20px;">STT</th>
              <th style="padding: 20px;">Chi·ªÅu R·ªông (mm)</th>
              <th style="padding: 20px;">Chi·ªÅu Cao (mm)</th>
              <th style="padding: 20px;">H√¨nh D·∫°ng</th>
              <th style="padding: 20px;">Di·ªán T√≠ch (mm¬≤)</th>
              <th style="padding: 20px;">ƒê∆∞·ªùng K√≠nh (mm)</th>
            </tr>
          </thead>
          <tbody id="resultsTableBody"></tbody>
        </table>
      </div>
      <div class="analysis-section card">
        <h2 style="margin-bottom: 12px;">K√≠ch Th∆∞·ªõc Khay & Tham S·ªë ƒêi·ªÅu Ch·ªânh</h2>
        <div class="tray-dimensions" style="margin-bottom: 12px;">
          <div class="input-group" style="display: flex; gap: 15px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 150px;">
              <label for="trayLength" style="display: block; margin-bottom: 4px; font-size: 14px;">Chi·ªÅu D√†i
                (mm):</label>
              <input type="number" id="trayLength" min="0" step="0.1" value="150"
                style="width: 100%; padding: 6px 8px; border-radius: 6px; font-size: 14px;">
            </div>
            <div style="flex: 1; min-width: 150px;">
              <label for="trayWidth" style="display: block; margin-bottom: 4px; font-size: 14px;">Chi·ªÅu R·ªông
                (mm):</label>
              <input type="number" id="trayWidth" min="0" step="0.1" value="80"
                style="width: 100%; padding: 6px 8px; border-radius: 6px; font-size: 14px;">
            </div>
          </div>
        </div>
        <div class="adjustment-parameters" style="margin-bottom: 12px;">
          <div class="slider-group" style="margin-bottom: 8px;">
            <label style="display: block; margin-bottom: 4px; font-size: 14px;">K√≠ch Th∆∞·ªõc T·ªëi Thi·ªÉu (mm): <span
                id="minSizeValue">1.0</span></label>
            <input type="range" id="minSize" min="0.5" max="10" step="0.1" value="1.0">
          </div>
          <div class="slider-group" style="margin-bottom: 8px;">
            <label style="display: block; margin-bottom: 4px; font-size: 14px;">K√≠ch Th∆∞·ªõc Font: <span
                id="fontSizeValue">16</span>px</label>
            <input type="range" id="fontSize" min="1" max="30" step="1" value="15">
          </div>
          <div class="slider-group" style="margin-bottom: 8px;">
            <label style="display: block; margin-bottom: 4px; font-size: 14px;">Ng∆∞·ª°ng h√¨nh tr√≤n: <span
                id="circleThresholdValue">0.75</span></label>
            <input type="range" id="circleThreshold" min="0.5" max="1" step="0.01" value="0.75">
          </div>
        </div>
        <button id="calculateBtn" class="btn" type="button"
          style="padding: 10px 20px; font-size: 14px; border-radius: 8px; width: 100%;">T√≠nh To√°n</button>
        
        <!-- Feedback Button -->
        <div style="text-align: center; margin-top: 15px;">
          <button id="feedbackBtn" type="button" onclick="enableFeedbackMode()"
            style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
                   color: white;
                   border: none;
                   padding: 12px 24px;
                   border-radius: 25px;
                   font-weight: bold;
                   cursor: pointer;
                   font-size: 14px;
                   box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                   transition: all 0.3s ease;
                   animation: pulse 2s infinite;">
            üéØ C·∫£i Thi·ªán Model
          </button>
          <div style="font-size: 12px; color: #666; margin-top: 5px;">
            üí° Gi√∫p model h·ªçc t·ª´ l·ªói ƒë·ªÉ c·∫£i thi·ªán ƒë·ªô ch√≠nh x√°c
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="statsModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>Th·ªëng K√™ Nhanh</h3>
      <p>T·ªïng s·ªë vi√™n: <span id="statTotal">0</span></p>
      <p>H√¨nh Tr√≤n: <span id="statCircle">0</span></p>
      <p>H√¨nh Tam Gi√°c: <span id="statTriangle">0</span></p>
      <canvas id="shapeChart" width="300" height="300"></canvas>
    </div>
  </div>
  <div id="helpModal" class="modal">
    <div class="modal-content" style="max-width: 320px;">
      <span class="close" id="closeHelpModal">&times;</span>
      <h3>L∆∞u √Ω</h3>
      <ul style="text-align:left; font-size:15px; padding-left:18px;">
        <li>Ch·ªâ s·ª≠ d·ª•ng ·∫£nh r√µ n√©t, kh√¥ng b·ªã m·ªù ho·∫∑c l√≥a s√°ng.</li>
        <li>Ch·ª©c nƒÉng "T·ª± ƒë·ªông c·∫Øt v√† ƒë·∫øm" ph√π h·ª£p v·ªõi ·∫£nh c√≥ v·∫≠t th·ªÉ nh·ªè. Kh√¥ng s√°t, ch·ªìng l√™n nhau.</li>
        <li>"Ng∆∞·ª°ng h√¨nh tr√≤n":
          <br> - 0.5: Ph√°t hi·ªán h√¨nh tr√≤n v·ªõi ƒë·ªô ch√≠nh x√°c th·∫•p, ph√π h·ª£p v·ªõi ·∫£nh c√≥ v·∫≠t th·ªÉ nh·ªè, bi·∫øn d·∫°ng.
          <br> - 0.75: Ph√°t hi·ªán h√¨nh tr√≤n v·ªõi ƒë·ªô ch√≠nh x√°c cao, ph√π h·ª£p v·ªõi ·∫£nh c√≥ v·∫≠t th·ªÉ l·ªõn.
          <br> - 1: Ph√°t hi·ªán h√¨nh tr√≤n v·ªõi ƒë·ªô ch√≠nh x√°c r·∫•t cao, ph√π h·ª£p v·ªõi ·∫£nh c√≥ v·∫≠t th·ªÉ.
        </li>
        <li>C√°c th√¥ng tin v·ªÅ tham s·ªë ch·ªâ l√† th√¥ng tin tham kh·∫£o, c√≥ th·ªÉ kh√¥ng ch√≠nh x√°c.</li>
      </ul>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>

</html>